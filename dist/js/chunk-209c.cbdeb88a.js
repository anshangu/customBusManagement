(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-209c"],{3885:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"dz-header"},[e._v("公交订单")]),a("div",{staticClass:"app-container pull-auto"},[a("basic-container",[a("div",{staticClass:"option-box"},[a("el-tag",{attrs:{type:"info",plain:""}},[e._v("时间区间")]),a("div",{staticClass:"div-left1 div-inline"},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择起始时间"},model:{value:e.selectBeginDateValue,callback:function(t){e.selectBeginDateValue=t},expression:"selectBeginDateValue"}})],1),a("div",{staticClass:"div-left1 div-inline"},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择终止时间"},model:{value:e.selectEndDateValue,callback:function(t){e.selectEndDateValue=t},expression:"selectEndDateValue"}})],1),a("div",{staticClass:"div-left1 div-inline"},[a("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.phone,callback:function(t){e.phone=t},expression:"phone"}})],1),a("div",{staticClass:"div-left1 div-inline"},[a("el-tag",{attrs:{type:"info",plain:""}},[e._v("线路")])],1),a("div",{staticClass:"div-left2 div-inline"},[a("el-select",{attrs:{clearable:"",placeholder:"(可选)请选择"},on:{change:e.updateSelectData1},model:{value:e.compoundParams.code1,callback:function(t){e.$set(e.compoundParams,"code1",t)},expression:"compoundParams.code1"}},e._l(e.code1List,function(e){return a("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}))],1),a("div",{staticClass:"div-left1 div-inline "},[a("el-tag",{attrs:{type:"info",plain:""}},[e._v("状态")])],1),a("div",{staticClass:"div-left2 div-inline"},[a("el-select",{attrs:{clearable:"",placeholder:"(可选)请选择"},on:{change:e.updateSelectData2},model:{value:e.compoundParams.code2,callback:function(t){e.$set(e.compoundParams,"code2",t)},expression:"compoundParams.code2"}},e._l(e.code2List,function(e){return a("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}))],1),a("el-button",{staticClass:"div-left2 div-inline",attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:e.handleFetch}},[e._v("查询")]),a("el-button",{staticClass:"div-left2 div-inline",attrs:{type:"primary",icon:" el-icon-download",size:"small"},on:{click:e.handleExport}},[e._v("导出")])],1),a("avue-crud",{ref:"crud",attrs:{page:e.page,data:e.tableData,"table-loading":e.tableLoading,option:e.tableOption},on:{"size-change":e.sizeChange,"current-change":e.currentChange,"refresh-change":e.refreshChange}})],1)],1)])},i=[],s=(a("96cf"),a("3040")),c=(a("f751"),a("7f7f"),a("ac6a"),a("c93e")),l=a("e864"),o={direction:[{label:"上行",value:0,color:"green"},{label:"下行",value:1,color:"green"}]},r={border:!0,index:!0,stripe:!0,menuAlign:"center",align:"center",editBtn:!1,delBtn:!1,viewBtn:!1,menuWidth:100,addBtn:!1,dicData:o,column:[{label:"交易日期",prop:"trade_time",align:"center",rules:[]},{label:"手机号",prop:"user_id",align:"center",rules:[]},{label:"订单编号",prop:"order_no",align:"center",rules:[]},{label:"线路",prop:"line",align:"center",rules:[]},{label:"班期",prop:"cust_bus_time",align:"center",rules:[]},{label:"支付金额",prop:"amount",align:"center",rules:[]},{label:"上下行",prop:"towards",align:"center",rules:[]},{label:"状态",prop:"ticket_state",align:"center"}]},d=a("5880"),u=a("c1df"),h=a.n(u),p={name:"custbus",data:function(){return{selectBeginDateValue:null,selectEndDateValue:null,compoundParams:{code1:null,code2:null},phone:null,code1List:[],code2List:[{code:3,name:"已退票"},{code:1,name:"已支付"},{code:2,name:"已核销"}],tableData:[],direction:o.direction,searchData:{city_code:"610300",start_time:null,end_time:null,toward:null,phone:null,line_code:null},page:{total:0,currentPage:1,pageSize:20},listQuery:{page:1,size:20},tableLoading:!1,tableOption:r}},created:function(){this.getList()},mounted:function(){},computed:Object(c["a"])({},Object(d["mapGetters"])(["permissions"])),methods:{getList:function(){var e=this;this.tableLoading=!0,Object(l["e"])({page:1,size:200}).then(function(t){if(t.data.data){t.data.data.result=_.map(t.data.data.result,function(e){return e.original_amt=String(e.original_amt/100),e.amt=String(e.amt/100),e});var a=t.data.data.result||t.data.records,n=[];a.forEach(function(e){var t=e.name+"-"+e.towards,a="上行"===e.towards?0:1,i=e.line_code+"_"+a,s=e.line_code;i&&n.push({name:t,code:i,towards:a,lineCode:s})}),e.code1List=n}else{var i=t.data.msg||"接口异常";e.$message({showClose:!0,message:i,type:"warning"})}e.tableLoading=!1})},currentChange:function(e){this.page.currentPage=e,this.listQuery.page=e,this.checkDate()&&this.fetch()},sizeChange:function(e){this.page.pageSize=e,this.listQuery.size=e,this.checkDate()&&this.fetch()},checkDate:function(){return!(!this.selectBeginDateValue||!this.selectEndDateValue)||(this.$message({showClose:!0,message:"请选择时间区间",type:"warning"}),!1)},handleExport:function(){if(this.checkDate()){this.searchData.start_time=h()(this.selectBeginDateValue).format("YYYY-MM-DD"),this.searchData.end_time=h()(this.selectEndDateValue).format("YYYY-MM-DD"),this.searchData.phone=this.phone;var e,t,a=this.compoundParams.code1;this.code1List.forEach(function(n){a===n.code&&(e=n.lineCode,t=n.towards)}),this.searchData.line_code=e,this.searchData.toward=t,this.searchData.ticket_state=this.compoundParams.code2,Object(l["i"])(this.searchData)}},handleFetch:function(){if(this.checkDate()){this.searchData.start_time=h()(this.selectBeginDateValue).format("YYYY-MM-DD"),this.searchData.end_time=h()(this.selectEndDateValue).format("YYYY-MM-DD"),this.searchData.phone=this.phone;var e,t,a=this.compoundParams.code1;this.code1List.forEach(function(n){a===n.code&&(e=n.lineCode,t=n.towards)}),this.searchData.line_code=e,this.searchData.toward=t,this.searchData.ticket_state=this.compoundParams.code2,this.fetch()}},fetch:function(){var e=this,t={};t=Object.assign(t,this.listQuery),t=Object.assign(t,this.searchData);var a=this;Object(l["h"])(t).then(function(t){t.data.data&&(e.tableData=t.data.data.result||t.data.records,e.page.total=t.data.data.total_count||t.data.total)}).catch(function(){var e={data:{result:[{order_no:"20180827204456186ptQAQa",ticket_state:"待支付",pay_state:0,amount:300,trade_time:"2018-08-30 16:35:56",line:"断桥残雪-浙大玉泉校区",user_name:"azaag7z",pay_type:"支付宝APP",towards:"上行"},{order_no:"20180827204456186ptQAQa",ticket_state:"待支付",pay_state:0,amount:300,trade_time:"2018-08-30 16:35:56",line:"浙大玉泉校区-断桥残雪",user_name:"azaag7z",pay_type:"支付宝APP",towards:"下行"},{order_no:"20180828173601653zFpQcN",ticket_state:"待支付",pay_state:0,amount:300,trade_time:"2018-08-28 17:36:01",line:"断桥残雪-浙大玉泉校区",user_name:"azaag7z",pay_type:"支付宝APP",towards:"上行"}],total_count:306},code:"0",message:"Success"};e.data&&(a.tableData=e.data.result||e.records,a.page.total=e.data.total_count||e.total)})},refreshChange:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getList();case 2:if(!this.checkDate()){e.next=5;break}return e.next=5,this.fetch();case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),updateSelectData1:function(){},updateSelectData2:function(){}}},m=p,f=(a("a8aa"),a("2877")),g=Object(f["a"])(m,n,i,!1,null,"6d59fb5f",null);g.options.__file="index.vue";t["default"]=g.exports},"5cce":function(e,t,a){},a8aa:function(e,t,a){"use strict";var n=a("5cce"),i=a.n(n);i.a}}]);